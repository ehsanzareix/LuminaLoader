class u{constructor(e={}){this.opts=e,this.container=null,this.progressValue=null,this.indeterminate=!1,this.progressEl=null,this.overlayEl=null,this.backdropEl=null,this.prevActiveElement=null,this.onKeydownHandler=t=>this.handleKeydown(t),this.themeMediaQuery=null,this.themeListener=null,this.currentTheme=null,typeof e.progress=="number"&&(this.progressValue=Math.max(0,Math.min(100,e.progress)),this.indeterminate=!1),this.applyTheme()}createImageElement(){const e=document.createElement("div");e.className="lumina-image-wrapper";const t=this.opts.size?`width:${this.opts.size}px;height:${this.opts.size}px;`:"";if(typeof this.opts.image=="string"){const i=document.createElement("img");i.className="lumina-image",i.src=this.opts.image,i.alt=this.opts.ariaLabel||"loading",i.setAttribute("style",`max-width:100%;max-height:100%;${t}`),e.appendChild(i)}else if(this.opts.image instanceof SVGElement){const i=this.opts.image.cloneNode(!0);i.classList.add("lumina-image"),this.opts.size&&(i.setAttribute("width",String(this.opts.size)),i.setAttribute("height",String(this.opts.size))),e.appendChild(i)}return this.opts.imageAnimation&&e.classList.add(`lumina-${this.opts.imageAnimation}`),e}renderProgress(e){const t=this.opts.progressVariant||"linear",i=document.createElement("div");if(i.className=`lumina-progress lumina-progress-${t}`,i.setAttribute("role","progressbar"),i.setAttribute("aria-valuemin","0"),i.setAttribute("aria-valuemax","100"),t==="linear"){const s=document.createElement("div");s.className="lumina-progress-track";const r=document.createElement("div");r.className="lumina-progress-bar",this.progressValue!==null?(r.style.width=`${this.progressValue}%`,r.setAttribute("aria-valuenow",String(this.progressValue))):this.indeterminate&&r.classList.add("lumina-indeterminate"),s.appendChild(r),i.appendChild(s),this.progressEl=r}else{const s=this.opts.size||80,r="http://www.w3.org/2000/svg",n=document.createElementNS(r,"svg");n.setAttribute("viewBox","0 0 100 100"),n.setAttribute("width",String(s)),n.setAttribute("height",String(s)),n.classList.add("lumina-progress-circular");const o=document.createElementNS(r,"circle");o.setAttribute("cx","50"),o.setAttribute("cy","50"),o.setAttribute("r","45"),o.setAttribute("class","lumina-progress-bg"),n.appendChild(o);const a=document.createElementNS(r,"circle");a.setAttribute("cx","50"),a.setAttribute("cy","50"),a.setAttribute("r","45"),a.setAttribute("class","lumina-progress-circle");const l=2*Math.PI*45;a.setAttribute("stroke-dasharray",String(l));const h=this.progressValue!==null?(100-this.progressValue)/100*l:l;a.setAttribute("stroke-dashoffset",String(h)),this.progressValue!==null&&a.setAttribute("aria-valuenow",String(this.progressValue)),n.appendChild(a),i.appendChild(n),this.progressEl=a}e.appendChild(i)}createOverlay(e){const t=document.createElement("div");t.className="lumina-overlay",t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true"),t.tabIndex=-1;const i=document.createElement("div");i.className="lumina-backdrop";const s=this.opts.backdrop||{},r=typeof s.opacity=="number"?s.opacity:.5,n=s.color||"black",o=s.blur?`backdrop-filter: blur(${s.blur});`:"";i.setAttribute("style",`background:${n};opacity:${r};${o}`),s.clickToClose&&i.addEventListener("click",()=>this.hide()),t.appendChild(i);const a=this.opts.overlayZIndex??1e3,l=t.getAttribute("style")||"";t.setAttribute("style",`${l};z-index:${a}`);const h=this.resolveTheme();h&&t.setAttribute("data-lumina-theme",h),(e??document.body).appendChild(t),this.overlayEl=t,this.backdropEl=i,(this.opts.theme??"auto")==="auto"&&this.watchTheme()}handleKeydown(e){if(this.overlayEl)if(e.key==="Tab"){const t=this.overlayEl.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])');if(!t.length)return;const i=t[0],s=t[t.length-1];e.shiftKey&&document.activeElement===i?(e.preventDefault(),s.focus()):!e.shiftKey&&document.activeElement===s&&(e.preventDefault(),i.focus())}else e.key==="Escape"&&this.hide()}trapFocus(){if(!this.overlayEl)return;this.prevActiveElement=document.activeElement;const e=this.overlayEl.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])');e.length?e[0].focus():this.overlayEl.focus(),document.addEventListener("keydown",this.onKeydownHandler),(this.opts.theme??"auto")==="auto"&&this.applyThemeToElement(this.overlayEl)}applyThemeToElement(e){if(!e)return;const t=this.resolveTheme();t?e.setAttribute("data-lumina-theme",t):e.removeAttribute("data-lumina-theme")}resolveTheme(){const e=this.opts.theme??"auto";if(e==="light"||e==="dark")return e;if(typeof window<"u"&&typeof window.matchMedia=="function")try{return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch{return"light"}return"light"}watchTheme(){if(!(typeof window>"u"||!("matchMedia"in window)))try{this.themeMediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this.themeListener=t=>{this.currentTheme=t.matches?"dark":"light",this.applyThemeToElement(this.overlayEl)};const e=this.themeMediaQuery;e&&("addEventListener"in e?e.addEventListener("change",this.themeListener):"addListener"in e&&e.addListener(this.themeListener))}catch{this.themeMediaQuery=null,this.themeListener=null}}applyTheme(){const e=this.opts.theme??"auto";if(e==="light"||e==="dark"){this.currentTheme=e,this.applyThemeToElement(this.overlayEl||this.container);return}if(typeof window<"u"&&"matchMedia"in window)try{const t=window.matchMedia("(prefers-color-scheme: dark)");this.currentTheme=t.matches?"dark":"light"}catch{this.currentTheme="light"}else this.currentTheme="light";this.applyThemeToElement(this.overlayEl||this.container)}releaseFocus(){if(document.removeEventListener("keydown",this.onKeydownHandler),this.prevActiveElement instanceof HTMLElement&&this.prevActiveElement.focus(),this.prevActiveElement=null,this.themeMediaQuery&&this.themeListener){try{"removeEventListener"in this.themeMediaQuery?this.themeMediaQuery.removeEventListener("change",this.themeListener):"removeListener"in this.themeMediaQuery&&this.themeMediaQuery.removeListener(this.themeListener)}catch{}this.themeListener=null,this.themeMediaQuery=null}}mount(){if(this.container)return;const e=typeof this.opts.target=="string"?document.querySelector(this.opts.target):this.opts.target??document.body,t=document.createElement("div");if(t.className="lumina-root",t.setAttribute("aria-hidden","true"),this.opts.overlay){this.createOverlay(e);const i=document.createElement("div");if(i.className="lumina-overlay-content",this.opts.type==="image"&&this.opts.image){const s=this.createImageElement(),r=document.createElement("div");r.className="lumina-loader lumina-image",r.appendChild(s),i.appendChild(r)}else if(this.opts.type==="progress")this.renderProgress(i);else{const s=document.createElement("div");s.className=`lumina-loader lumina-${this.opts.type||"spinner"}`,s.innerHTML='<div class="lumina-spinner"></div>',i.appendChild(s)}this.overlayEl&&this.overlayEl.appendChild(i),this.container=this.overlayEl}else{if(this.opts.type==="image"&&this.opts.image){const i=this.createImageElement(),s=document.createElement("div");s.className="lumina-loader lumina-image",s.appendChild(i),t.appendChild(s)}else this.opts.type==="progress"?this.renderProgress(t):t.innerHTML=`<div class="lumina-loader lumina-${this.opts.type||"spinner"}"><div class="lumina-spinner"></div></div>`;(e??document.body).appendChild(t),this.container=t}}show(){var e;if(this.container||this.mount(),(e=this.container)==null||e.setAttribute("aria-hidden","false"),this.overlayEl){const t=typeof this.opts.target=="string"?document.querySelector(this.opts.target):this.opts.target??document.body;t instanceof HTMLElement&&t.setAttribute("aria-busy","true"),this.trapFocus()}}hide(){var e;if((e=this.container)==null||e.setAttribute("aria-hidden","true"),this.overlayEl){const t=typeof this.opts.target=="string"?document.querySelector(this.opts.target):this.opts.target??document.body;t instanceof HTMLElement&&t.removeAttribute("aria-busy"),this.releaseFocus(),this.overlayEl.remove(),this.overlayEl=null,this.backdropEl=null,this.container=null}}setProgress(e){const t=Math.max(0,Math.min(100,Math.round(e)));if(this.progressValue=t,this.indeterminate=!1,!this.container)return;const i=this.container.querySelector('[role="progressbar"]');if(i)if(i.classList.contains("lumina-progress-linear")||i.classList.contains("lumina-progress")&&i.querySelector(".lumina-progress-bar")){const s=i.querySelector(".lumina-progress-bar");s&&(s.style.width=`${t}%`,s.setAttribute("aria-valuenow",String(t)),s.classList.remove("lumina-indeterminate"))}else{const s=i.querySelector(".lumina-progress-circle");if(s){const r=Number(s.getAttribute("stroke-dasharray"))||2*Math.PI*45,n=(100-t)/100*r;s.setAttribute("stroke-dashoffset",String(n)),s.setAttribute("aria-valuenow",String(t))}}}setIndeterminate(e=!0){if(this.indeterminate=e,this.progressValue=null,!this.container)return;const t=this.container.querySelector('[role="progressbar"]');if(!t)return;const i=t.querySelector(".lumina-progress-bar");i&&(e?i.classList.add("lumina-indeterminate"):i.classList.remove("lumina-indeterminate"))}destroy(){var e;this.overlayEl&&(this.overlayEl.remove(),this.overlayEl=null,this.backdropEl=null),this.releaseFocus(),(e=this.container)==null||e.remove(),this.container=null}}function m(c){const e=new u(c);return e.mount(),e}export{m as c};
